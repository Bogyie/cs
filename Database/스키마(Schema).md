# 스키마

## 정의

- 데이터베이스의 구조와 제약조건에 대한 명세를 기술한 것을 의미한다.
- 데이터베이스 관리 시스템(DBMS)이 주어진 설정에 따라 데이터베이스 스키마를 생성하며, 데이터베이스 사용자가 자료를 저장, 조회, 삭제, 변경할 때 DBMS는 자신이 생성한 데이터베이스 스키마를 참조하여 명령을 수행한다.

## 특징

- __데이터 사전(= 시스템 카탈로그)에 저장__
    - 데이터베이스에 저장되어 있는 모든 데이터 개체들에 대한 정보를 유지, 관리하는 시스템
    - DB 안에는 데이터만 존재하는 것이 아니라 해당 데이터를 설명하기 위한 공간이 존재하는데 그것이 데이터 사전을 의미
    - MySQL 에서는 `information_schema` 가 데이터 사전을 의미
        - MySQL 서버 내에 존재하는 DB 의 메타 정보(테이블, 칼럼, 인덱스 등의 스키마 정보)를 모아둔 곳이다.
        - ```sql
          -- information_schema 가 지원하는 모든 정보 확인
          select TABLE_SCHEMA, TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA = 'information_schema';

          -- information_schema 사용
          use information_schema;
          -- 테이블 목록 보기
          show tables;
          ```
- __데이터베이스의 구조에 대한 정의__
- __메타 데이터라고도 함__

## 스키마 3계층

![IMAGES](../images/schema.png)

### 외부 스키마

- 서브스키마(사용자 뷰)라고 부르기도 함
- 사용자가 보는 관점(사용자에 따라 다르고, 여러 개 존재)
- 사용자와 관련된 데이터베이스 부분만 정의해 놓은 것
- 동일한 데이터베이스에 대해서 서로 다른 관점을 정의할 수 있도록 허용한다.
    - Ex. 한 사용자는 회원 테이블에 대해서 SELECT * FROM MEMBER 로 데이터를 볼 수 도 있고, 다른 사용자는 JOIN 을 사용하여 데이터를 볼 수 있다. 즉, SELECT 쿼리를 던졌을 때 볼 수 있는 테이블 또는 뷰를 외부 스키마라고 할 수 있다.

### 개념 스키마

- DB 전체의 `논리적인 구조`를 정의
- 상품 테이블, 주문 테이블, 회원 정보 테이블과 같은 객체 간의 관계와 제약조건, DB 의 접근 권한, 무결성 규칙 등에 대한 명세를 정의.
 
### 내부 스키마

- 물리적 저장장치와 밀접한 계층
- 실제로 데이터베이스에 저장될 레코드의 `물리적인 구조`를 정의
- 시스템 설계자 입장에서 바라본 스키마로, 어떤 테이블이 어디에 저장되게 할 것인지, 저장되는 구조와 경로, 순서 등을 정의 해놓은 것

## 테이블 vs 스키마

테이블과 스키마에 대한 내용을 찾아보던 중, 블로그마다 말이 다른 부분도 많아 스택 오버 플로우 답변을 참고하였다.

> https://stackoverflow.com/questions/11618277/difference-between-schema-database-in-mysql/19257781#19257781

- __답변 1__
    - MySQL 에서 물리적으로 스키마는 데이터베이스와 동의어이다. 
    - MySQL 의 SQL 구문에서 DATABASE 대신 SCHEMA 로 대체할 수 있다.
        - Ex. CREATE DATABASE 대신 CREATE SCHEMA
    - 일부 다른 데이터베이스 제품은 구별된다. 예를 들어, Oracle Database 제품에서 스키마는 데이터베이스의 일부, 즉 단일 사용자가 소유한 테이블 및 기타 객체만을 나타낸다.
- __답변 2__
    - DB 벤더마다 다르지만, 보통 스키마는 테이블의 모음을 의미하고 데이터베이스는 스키마의 모음을 의미한다.

확실한 것은 벤더마다 스키마에 대한 정의가 조금씩 다르다는 것이다.

위에서 CREATE DATABASE 대신 CREATE SCHEMA 로 대체가 가능하다고 해서 테스트를 해봤다.

![IMAGES](../images/schema_test.png)

![IMAGES](../images/schema_test2.png)

직접 테스트한 결과 동일한 것으로 보인다.

그러면 위에서 배운 스키마에 대한 내용을 MySQL 에 적용하면 `개념스키마 = 스키마 = 데이터베이스` 라고 보여진다.

면접에서 테이블과 스키마의 차이점에 대해서 물어본다면 다음과 같이 대답할 수 있을 것 같다.

#### 진짜 간단하게 답변하는 경우 

진짜 간단하게 답변하는 경우는 `일반적으로 정처기에서 나오는 스키마의 사전적인 의미에 대해서만 답변하는 경우`를 의미한다.

- 테이블 : 행과 열로 구성된 데이터의 집합.
- 스키마 : 데이터베이스의 테이블, 열, 유형을 정의.

#### 조금더 인상깊은 답변을 하는 경우

조금더 인상깊은 답변을 하는 경우 스키마라는 명칭 자체가 DB 벤더마다 다르기 때문에 DB 벤더마다 스키마가 어떤 의미로 사용되고 있는지에 대해서 차이점을 예로 들어 답변하는 경우가 되겠다.

테이블은 행과 열로 구성된 데이터 집합을 의미하고, 스키마는 제약조건, 무결성 규칙, 테이블, 열과 데이터 유형 등을 정의한 것입니다. 저희가 흔히 스키마라고 부르는것은 개념 스키마를 의미하는데, MySQL 에서는 스키마랑 데이터베이스랑 동일하게 볼 수 있습니다. 실제로 MySQL 에서 CREATE DATABASE 대신에 CREATE SCHEMA 를 사용하여 데이터베이스를 생성할 수 있습니다.
오라클에서의 SCHEMA 는 단일 사용자가 소유한 테이블을 의미합니다. DB 벤더마다 스키마가 다른 의미로 사용되고 있다는 것을 볼 수 있습니다.

> MySQL 에서는 스키마 = 데이터베이스, Oralce 은 스키마 != 데이터베이스

## 외부 스키마 vs 개념 스키마

외부 스키마 vs 개념 스키마에 대한 질문이 들어온다면 사전적인 의미의 스키마에 대해서 물어보는 것이므로 아래와 같이 답변하면 될 것 같다.

외부 스키마는 사용자 뷰라고도 부르며, 사용자와 관련된 데이터베이스 부분만 정의해 놓은 것을 의미합니다. 어떤 사용자는 회원 테이블을 SELECT 로 조회할 수도 있고, JOIN 을 이용하여 데이터를 조회할 수도 있습니다.
따라서, SELECT 로 조회 가능한 테이블 또는 뷰를 외부 스키마라고도 할 수 있습니다.

개념 스키마는 객체 간의 관계와 제약조건, DB 의 접근 권한, 무결성 규칙 등에 대한 명세를 정의한 것을 의미합니다.

## References

- https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%EC%8A%A4%ED%82%A4%EB%A7%88
- https://y-oni.tistory.com/75
- https://stackoverflow.com/questions/11618277/difference-between-schema-database-in-mysql/19257781#19257781
- https://rh-cp.tistory.com/42
- https://sidorl.tistory.com/10
